# AI ç¬”è®°ç”Ÿæˆå™¨ ğŸ¤–ğŸ“

ä¸€ä¸ªåŸºäº Next.js + TypeScript çš„æ™ºèƒ½ç¬”è®°åº”ç”¨ï¼Œé›†æˆ GitHub åŒæ­¥åŠŸèƒ½ï¼Œæ”¯æŒæ–‡ä»¶å¤¹ç»„
ç»‡ï¼Œèƒ½å¤Ÿå°†ä»»æ„æ•°æ®äº¤ç»™ AI æ•´ç†æˆç»“æ„åŒ–çš„ Markdown ç¬”è®°ã€‚

![é¡¹ç›®ä¸»ç•Œé¢](./docs/images/main-interface.png)

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ æ™ºèƒ½ç¬”è®°ç”Ÿæˆ

- **AI é©±åŠ¨** - ä½¿ç”¨ Google Cloud Vertex AI æ™ºèƒ½æ•´ç†å†…å®¹
- **ç»“æ„åŒ–è¾“å‡º** - è‡ªåŠ¨ç”Ÿæˆæ ‡å‡† Markdown æ ¼å¼ç¬”è®°
- **å†…å®¹å¢å¼º** - AI è‡ªåŠ¨è¡¥å……ç›¸å…³çŸ¥è¯†å’Œæ·±å…¥è§è§£
- **æ™ºèƒ½æ ‡é¢˜** - æ ¹æ®å†…å®¹è‡ªåŠ¨ç”Ÿæˆåˆé€‚çš„æ ‡é¢˜

### ğŸ“ æ–‡ä»¶å¤¹ç®¡ç†

- **å±‚æ¬¡ç»“æ„** - æ”¯æŒæ— é™å±‚çº§çš„æ–‡ä»¶å¤¹åµŒå¥—
- **æ‹–æ‹½æ“ä½œ** - ç›´è§‚çš„æ–‡ä»¶å¤¹å’Œç¬”è®°ç®¡ç†
- **æ ‘å½¢è§†å›¾** - æ¸…æ™°çš„æ–‡ä»¶å¤¹æ ‘å½¢å±•ç¤º
- **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ–‡ä»¶å¤¹å’Œç¬”è®°çš„æ‰¹é‡ç®¡ç†

### ğŸ”— GitHub é›†æˆ

- **åŒå‘åŒæ­¥** - åº”ç”¨ä¸ GitHub ä»“åº“ä¹‹é—´çš„åŒå‘åŒæ­¥
- **ç‰ˆæœ¬æ§åˆ¶** - å®Œæ•´çš„ç‰ˆæœ¬å†å²å’Œå†²çªè§£å†³
- **å¯¼å…¥åŠŸèƒ½** - ä»ç°æœ‰ GitHub ä»“åº“å¯¼å…¥ç¬”è®°å’Œæ–‡ä»¶å¤¹ç»“æ„
- **å®æ—¶çŠ¶æ€** - åŒæ­¥çŠ¶æ€å®æ—¶æ˜¾ç¤ºå’Œç›‘æ§

### ğŸ¨ ç°ä»£åŒ–ç•Œé¢

- **å“åº”å¼è®¾è®¡** - å®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- **æš—è‰²æ¨¡å¼** - æ”¯æŒæ˜æš—ä¸»é¢˜åˆ‡æ¢
- **ä¼˜é›…åŠ¨ç”»** - æµç•…çš„äº¤äº’åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ
- **ç›´è§‚æ“ä½œ** - ç®€æ´ç›´è§‚çš„ç”¨æˆ·ç•Œé¢

## ğŸ›  æŠ€æœ¯æ ˆ

**å‰ç«¯æ¶æ„**

- **Next.js 15** - æœ€æ–°çš„ React å…¨æ ˆæ¡†æ¶ï¼Œä½¿ç”¨ App Router
- **TypeScript** - å®Œæ•´çš„ç±»å‹å®‰å…¨ä¿éšœ
- **Tailwind CSS** - ç°ä»£åŒ– CSS æ¡†æ¶
- **Zustand** - è½»é‡çº§çŠ¶æ€ç®¡ç†
- **React 19** - æœ€æ–°çš„ React ç‰ˆæœ¬

**åç«¯æœåŠ¡**

- **Google Cloud Vertex AI** - ä¼ä¸šçº§ AI æ–‡æœ¬ç”Ÿæˆ
- **Firebase Firestore** - å®æ—¶æ•°æ®åº“ï¼ˆæ‰å¹³åŒ–ç»“æ„ï¼‰
- **Firebase Auth** - ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- **GitHub API** - ç‰ˆæœ¬æ§åˆ¶å’ŒåŒæ­¥

**å¼€å‘å·¥å…·**

- **Turbopack** - è¶…å¿«çš„å¼€å‘æ„å»ºå·¥å…·
- **Prism.js** - ä»£ç è¯­æ³•é«˜äº®
- **KaTeX** - æ•°å­¦å…¬å¼æ¸²æŸ“
- **DOMPurify** - å†…å®¹å®‰å…¨è¿‡æ»¤

## ğŸ“‚ é¡¹ç›®æ¶æ„

```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ notes/         # ç¬”è®° CRUD æ¥å£
â”‚   â”‚   â”œâ”€â”€ folders/       # æ–‡ä»¶å¤¹ç®¡ç†æ¥å£
â”‚   â”‚   â”œâ”€â”€ github/        # GitHub é›†æˆæ¥å£
â”‚   â”‚   â”œâ”€â”€ users/         # ç”¨æˆ·ç®¡ç†æ¥å£
â”‚   â”‚   â””â”€â”€ generative/    # AI ç”Ÿæˆæ¥å£
â”‚   â”œâ”€â”€ notes/[id]/        # åŠ¨æ€ç¬”è®°è¯¦æƒ…é¡µ
â”‚   â”œâ”€â”€ github-settings/   # GitHub é…ç½®é¡µé¢
â”‚   â””â”€â”€ page.tsx           # ä¸»é¡µé¢
â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”œâ”€â”€ auth/             # è®¤è¯ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AuthProvider.tsx
â”‚   â”‚   â”œâ”€â”€ LoginButton.tsx
â”‚   â”‚   â”œâ”€â”€ ProtectedRoute.tsx
â”‚   â”‚   â””â”€â”€ UserProfile.tsx
â”‚   â”œâ”€â”€ FolderTree.tsx     # æ–‡ä»¶å¤¹æ ‘ç»„ä»¶
â”‚   â”œâ”€â”€ GithubSettings.tsx # GitHub è®¾ç½®ç»„ä»¶
â”‚   â”œâ”€â”€ SyncStatusIcon.tsx # åŒæ­¥çŠ¶æ€å›¾æ ‡
â”‚   â”œâ”€â”€ MarkdownRenderer.tsx # Markdown æ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ Layout.tsx         # å…¨å±€å¸ƒå±€
â”‚   â”œâ”€â”€ Sidebar.tsx        # ä¾§è¾¹æ 
â”‚   â””â”€â”€ Navbar.tsx         # å¯¼èˆªæ 
â”œâ”€â”€ lib/                   # æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ ai.ts             # AI æœåŠ¡å°è£…
â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯é€»è¾‘
â”‚   â”œâ”€â”€ firebase.ts       # Firebase é…ç½®
â”‚   â”œâ”€â”€ github.ts         # GitHub æœåŠ¡
â”‚   â””â”€â”€ utils.ts          # å·¥å…·å‡½æ•°
â”œâ”€â”€ stores/               # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯çŠ¶æ€
â”‚   â”œâ”€â”€ notes.ts          # ç¬”è®°çŠ¶æ€
â”‚   â”œâ”€â”€ github.ts         # GitHub çŠ¶æ€
â”‚   â””â”€â”€ index.ts          # ç»Ÿä¸€å¯¼å‡º
â””â”€â”€ styles/               # æ ·å¼æ–‡ä»¶
    â”œâ”€â”€ globals.css
    â”œâ”€â”€ code-block.css
    â””â”€â”€ prism.css
```

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### Firestore æ‰å¹³åŒ–ç»“æ„

```
Firestore Collections:
â”œâ”€â”€ users/
â”‚   â””â”€â”€ {userId}: {
â”‚       email, displayName, photoURL,
â”‚       createdAt, updatedAt
â”‚     }
â”œâ”€â”€ notes/
â”‚   â””â”€â”€ {noteId}: {
â”‚       title, content, userId, folderId,
â”‚       githubPath, githubSha, syncStatus,
â”‚       createdAt, updatedAt, ...
â”‚     }
â”œâ”€â”€ folders/
â”‚   â””â”€â”€ {folderId}: {
â”‚       name, parentId, userId, githubPath,
â”‚       createdAt, updatedAt, ...
â”‚     }
â””â”€â”€ github_configs/
    â””â”€â”€ {userId}: {
        accessToken, repoOwner, repoName,
        defaultBranch, basePath, updatedAt
}
```

### ä¼˜åŠ¿

- **æŸ¥è¯¢æ€§èƒ½æ›´å¥½** - å‡å°‘æ·±åº¦åµŒå¥—æŸ¥è¯¢
- **æ‰©å±•æ€§æ›´å¼º** - æ”¯æŒåˆ†äº«ã€åä½œç­‰åŠŸèƒ½
- **ç»´æŠ¤æ›´ç®€å•** - æ•°æ®å…³ç³»æ¸…æ™°
- **æƒé™æ§åˆ¶ç²¾ç¡®** - åŸºäºæ–‡æ¡£çº§åˆ«çš„æƒé™

## ğŸ”§ åŠŸèƒ½æ¨¡å—

### 1. æ™ºèƒ½ç¬”è®°ç”Ÿæˆ

```typescript
// AI ç”Ÿæˆç¬”è®°
export async function generateNote(prompt: string): Promise<string> {
  const vertexAI = new VertexAI({
    project: GOOGLE_CLOUD_PROJECT,
    location: GOOGLE_CLOUD_LOCATION,
  })

  const model = vertexAI.getGenerativeModel({ model: MODEL_NAME })
  const fullPrompt = `å¸®æˆ‘å°†ä»¥ä¸‹å†…å®¹æ•´ç†å¹¶è¡¥å……ä¸ºä¸€ç¯‡ç¬”è®°ï¼Œ
  ä½ ä¹Ÿå¯ä»¥æä¾›ä¸€ä¸‹æ·±å…¥è§è§£ã€‚æ³¨æ„ï¼šä½ è¿”å›çš„å›ç­”å†…å®¹å¿…é¡»å…¨éƒ¨éƒ½æ˜¯mdæ ¼å¼çš„å†…å®¹ï¼Œ
  å¹¶ä¸”åªèƒ½åŒ…å«å’Œè¿™ç¯‡ç¬”è®°æœ‰å…³çš„å†…å®¹ã€‚å†…å®¹ï¼š\n\n${prompt}`

  const result = await model.generateContentStream({
    contents: [{ role: 'user', parts: [{ text: fullPrompt }] }],
  })

  const response = await result.response
  return response?.candidates?.[0]?.content?.parts?.[0]?.text || ''
}
```

### 2. æ–‡ä»¶å¤¹ç®¡ç†

```typescript
// æ–‡ä»¶å¤¹ CRUD API - æ‰å¹³åŒ–ç»“æ„
export async function POST(request: NextRequest) {
  const { name, parentId, userId } = await request.json()

  const folderRef = await addDoc(collection(db, 'folders'), {
    name,
    parentId: parentId || null,
    userId,
    createdAt: serverTimestamp(),
    updatedAt: serverTimestamp(),
  })

  return NextResponse.json({ success: true, folderId: folderRef.id })
}
```

### 3. GitHub åŒæ­¥

```typescript
// GitHub é…ç½®ä¿å­˜ - æ‰å¹³åŒ–ç»“æ„
export async function POST(request: NextRequest) {
  const { config, userId } = await request.json()

  // éªŒè¯ GitHub è¿æ¥
  const githubService = new GitHubService(config)
  const connectionResult = await githubService.testConnection()

  if (connectionResult.success) {
    // ä¿å­˜é…ç½®åˆ° Firestore
    await setDoc(doc(db, 'github_configs', userId), {
      ...config,
      updatedAt: serverTimestamp(),
    })

    return NextResponse.json({ success: true })
  }

  return NextResponse.json(
    {
      success: false,
      error: connectionResult.error,
    },
    { status: 400 }
  )
}
```

## ğŸ“¦ éƒ¨ç½²å’Œè¿è¡Œ

### ç¯å¢ƒé…ç½®

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd wrangler

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env.local
```

### ç¯å¢ƒå˜é‡è®¾ç½®

```env
# Google Cloud Vertex AI
GOOGLE_CLOUD_PROJECT=your-project-id
GOOGLE_CLOUD_LOCATION=us-central1
GOOGLE_CLOUD_CREDENTIALS=path/to/service-account.json

# Firebase é…ç½®
NEXT_PUBLIC_FIREBASE_API_KEY=your-api-key
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your-auth-domain
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your-project-id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your-storage-bucket
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your-sender-id
NEXT_PUBLIC_FIREBASE_APP_ID=your-app-id
```

### Firestore é…ç½®éƒ¨ç½²

```bash
# å®‰è£… Firebase CLI
npm install -g firebase-tools

# ç™»å½• Firebase
firebase login

# åˆå§‹åŒ–é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
firebase init firestore

# éƒ¨ç½²ç´¢å¼•å’Œå®‰å…¨è§„åˆ™
chmod +x scripts/deploy-firestore.sh
./scripts/deploy-firestore.sh

# æˆ–è€…æ‰‹åŠ¨éƒ¨ç½²
firebase deploy --only firestore:indexes
firebase deploy --only firestore:rules
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¼€å‘æ¨¡å¼ï¼ˆä½¿ç”¨ Turbopackï¼‰
npm run dev

# ç”Ÿäº§æ„å»º
npm run build
npm start
```

## ğŸ”’ å®‰å…¨é…ç½®

### Firestore å®‰å…¨è§„åˆ™

é¡¹ç›®ä½¿ç”¨ä¸¥æ ¼çš„å®‰å…¨è§„åˆ™ç¡®ä¿æ•°æ®å®‰å…¨ï¼š

```javascript
// ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
match /notes/{noteId} {
  allow read, write: if request.auth != null &&
    resource.data.userId == request.auth.uid;
}

// æ”¯æŒå…¬å…±ç¬”è®°ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
match /notes/{noteId} {
  allow read: if resource.data.isPublic == true;
}
```

### å¿…éœ€çš„ç´¢å¼•

ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹å¤åˆç´¢å¼•ä»¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼š

- `notes`: userId + updatedAt (desc)
- `notes`: userId + folderId + updatedAt (desc)
- `folders`: userId + parentId
- `folders`: userId + createdAt (desc)

## ğŸ¯ é¡¹ç›®äº®ç‚¹

### æŠ€æœ¯åˆ›æ–°

1. **æ‰å¹³åŒ–æ•°æ®ç»“æ„** - ä¼˜åŒ–çš„ Firestore å­˜å‚¨æ¶æ„
2. **å®Œæ•´çš„ TypeScript å®ç°** - ä»å‰ç«¯åˆ°åç«¯çš„å…¨é“¾è·¯ç±»å‹å®‰å…¨
3. **ç°ä»£åŒ–æŠ€æœ¯æ ˆ** - Next.js 15 + React 19 + Turbopack
4. **æ™ºèƒ½ AI é›†æˆ** - æ·±åº¦é›†æˆ Google Cloud Vertex AI
5. **å®æ—¶åŒæ­¥æ¶æ„** - Firebase + GitHub åŒå‘åŒæ­¥

### åŠŸèƒ½ç‰¹è‰²

1. **æ–‡ä»¶å¤¹ç®¡ç†** - æ”¯æŒæ— é™å±‚çº§çš„æ–‡ä»¶å¤¹åµŒå¥—
2. **GitHub é›†æˆ** - å®Œæ•´çš„ç‰ˆæœ¬æ§åˆ¶å’ŒåŒæ­¥åŠŸèƒ½
3. **æ™ºèƒ½ç”Ÿæˆ** - AI é©±åŠ¨çš„å†…å®¹ç”Ÿæˆå’Œä¼˜åŒ–
4. **å®æ—¶åä½œ** - å¤šè®¾å¤‡é—´çš„å®æ—¶æ•°æ®åŒæ­¥
5. **ç”¨æˆ·ä½“éªŒ** - ç›´è§‚çš„ç•Œé¢å’Œæµç•…çš„äº¤äº’

### æ¶æ„ä¼˜åŠ¿

1. **æ¨¡å—åŒ–è®¾è®¡** - æ¸…æ™°çš„ä»£ç ç»“æ„å’Œç»„ä»¶åˆ†ç¦»
2. **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
3. **æ€§èƒ½ä¼˜åŒ–** - æ‰å¹³åŒ–ç»“æ„ + å¤åˆç´¢å¼•
4. **å¯æ‰©å±•æ€§** - æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œé›†æˆ
5. **å¯ç»´æŠ¤æ€§** - æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ–‡æ¡£

## ğŸš€ æœªæ¥è§„åˆ’

### çŸ­æœŸç›®æ ‡

- [ ] å®Œå–„ GitHub åŒæ­¥åŠŸèƒ½å®ç°
- [ ] å®ç°ç¬”è®°æ‰¹é‡å¯¼å…¥
- [ ] æ·»åŠ åŒæ­¥å†²çªè§£å†³
- [ ] ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ

### ä¸­æœŸç›®æ ‡

- [ ] å¤šäººåä½œåŠŸèƒ½
- [ ] æ’ä»¶ç³»ç»Ÿ
- [ ] ä¸»é¢˜å®šåˆ¶
- [ ] é«˜çº§æœç´¢

### é•¿æœŸç›®æ ‡

- [ ] å¤šäº‘å­˜å‚¨æ”¯æŒ
- [ ] AI åŠ©æ‰‹åŠŸèƒ½
- [ ] å›¢é˜Ÿå·¥ä½œç©ºé—´
- [ ] API å¼€æ”¾å¹³å°

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

**æ³¨æ„**: å‡çº§åˆ°æ‰å¹³åŒ–ç»“æ„åï¼Œå»ºè®®é‡æ–°éƒ¨ç½² Firestore é…ç½®ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚
